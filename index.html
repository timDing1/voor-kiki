<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Voor jou üí´</title>
  <meta name="description" content="Een kleine, lieve, interactieve liefdesbrief als webapp üòò" />
  <style>
    :root{
      --text:#f9fafb;
      --muted:#cbd5e1;
      --accent:#ef476f;
      --radius:18px;
      --glass: rgba(255,255,255,.08);
      --glass-border: rgba(255,255,255,.2);
      --cx: 50%;
      --cy: 50%;
      --r: 150vmax;
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      color: var(--text);
      background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
      overflow-x:hidden;
    }
    .hidden{opacity:0; pointer-events:none; transform: scale(.98); transition: opacity .6s ease, transform .6s ease}
    .show{opacity:1; transform: none}

    /* INTRO */
    .intro{
      position:fixed; inset:0; display:grid; place-items:center; z-index:20;
      background: radial-gradient(ellipse at bottom, #0e1622 0%, #07080d 100%);
      clip-path: circle(var(--r) at var(--cx) var(--cy));
      transition: clip-path 900ms cubic-bezier(.2,.8,.2,1), opacity .6s ease;
    }
    .intro.explode{ --r: 0vmax; opacity: 0; }
    .intro .box{
      text-align:center; padding: clamp(20px, 5vw, 48px);
      border-radius: 22px; backdrop-filter: blur(12px);
      background: rgba(255,255,255,.06); border:1px solid var(--glass-border);
      box-shadow: 0 20px 60px rgba(0,0,0,.45);
      max-width: 820px; margin: 0 16px;
      animation: floaty 6s ease-in-out infinite alternate;
    }
    @keyframes floaty{ from{ transform: translateY(0) } to{ transform: translateY(-6px) } }
    .intro h1{margin:0 0 .4rem 0; font-size: clamp(28px, 5vw, 40px)}
    .intro p{margin:.4rem 0; color: var(--muted)}
    .intro .cta{
      margin-top:1.2rem; padding:.9rem 1.2rem; font-weight:800; font-size:1rem;
      border-radius:14px; border:none; cursor:pointer;
      background: linear-gradient(180deg, #ffdbe6, #ffc5d7); color:#7b1233;
      box-shadow: 0 10px 30px rgba(239,71,111,.25);
      transition: transform .15s ease; 
    }
    .intro .cta:hover{ transform: translateY(-2px) }
    .intro .mini{ margin-top:.9rem; font-size:.92rem; color:#ffd6f3; font-style: italic }

    /* STARS */
    .stars, .stars2, .stars3{ position:fixed; inset:0; z-index:0; pointer-events:none; overflow:hidden }
    .stars span, .stars2 span, .stars3 span{
      position:absolute; border-radius:50%; background:#fff; opacity:.85;
      box-shadow: 0 0 6px 2px rgba(255,255,255,.65), 0 0 20px rgba(173,216,255,.35);
      animation: twinkle 4s ease-in-out infinite alternate;
    }
    .stars2 span{ opacity:.9; box-shadow:0 0 8px 3px rgba(255,255,255,.7), 0 0 30px rgba(173,216,255,.45) }
    .stars3 span{ opacity:1; box-shadow:0 0 10px 4px rgba(255,255,255,.8), 0 0 40px rgba(255,200,250,.5) }
    @keyframes twinkle{ from{opacity:.5; transform: translateY(0) scale(.9)} to{opacity:1; transform: translateY(-2px) scale(1.15)} }
    .stars{ animation: drift1 60s linear infinite }
    .stars2{ animation: drift2 90s linear infinite }
    .stars3{ animation: drift3 120s linear infinite }
    @keyframes drift1{ from{transform:translateY(0)} to{transform:translateY(-30px)} }
    @keyframes drift2{ from{transform:translateY(0)} to{transform:translateY(-45px)} }
    @keyframes drift3{ from{transform:translateY(0)} to{transform:translateY(-60px)} }

    /* Shooting stars */
    .streak{
      position:fixed; width:2px; height:2px; background:linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,1));
      filter: drop-shadow(0 0 6px white);
      transform: rotate(-20deg);
      animation: shoot 1.2s ease-out forwards;
      z-index:1; pointer-events:none;
    }
    @keyframes shoot{ 0%{opacity:0; transform: translate(-10vw,-10vh) rotate(-20deg) scaleX(1)} 10%{opacity:1} 100%{opacity:0; transform: translate(60vw, 40vh) rotate(-20deg) scaleX(40)} }

    /* Burst stars */
    .burst-star{
      position: fixed; width:3px; height:3px; background:white; border-radius:50%;
      box-shadow: 0 0 6px 2px rgba(255,255,255,.7);
      animation: burst 700ms ease-out forwards;
      z-index: 25; pointer-events:none;
    }
    @keyframes burst{ from{opacity:1; transform: translate(0,0) scale(1)} to{opacity:0; transform: translate(var(--tx), var(--ty)) scale(0.5)} }

    /* APP */
    .wrap{ min-height:100dvh; display:grid; place-items:center; padding: clamp(16px, 4vw, 48px); position:relative; z-index:5 }
    .card{
      width:min(920px, 100%); background: var(--glass); border:1px solid var(--glass-border);
      border-radius: var(--radius); box-shadow: 0 20px 60px rgba(0,0,0,.45); backdrop-filter: blur(12px);
      overflow:hidden; opacity:0; transform: translateY(8px) scale(.985); filter: blur(8px);
      transition: opacity .6s ease, transform .6s ease, filter .6s ease;
    }
    .card.app-enter{ opacity:1; transform:none; filter: blur(0) }
    header{ padding:clamp(16px,3vw,28px) clamp(16px,4vw,40px); display:flex; align-items:center; gap:14px; border-bottom:1px dashed rgba(255,255,255,.15)}
    header .emoji{ font-size: clamp(34px, 5vw, 50px) }
    header h1{ margin:0; font-size:clamp(22px,4.5vw,34px) }
    header small{ color: var(--muted) }
    main{ padding:clamp(18px,4vw,44px); display:grid; gap:28px }
    @media (min-width: 840px){ main{ grid-template-columns: 1.2fr .8fr; align-items:start } }

    .panel{ background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.15); border-radius: calc(var(--radius) - 6px); padding: clamp(14px,2.5vw,24px) }
    .type{ font-size:clamp(18px,3.6vw,22px); line-height:1.6 }
    .muted{ color:var(--muted) }

    .btns{ display:flex; flex-wrap:wrap; gap:10px; align-items:center }
    button, .chip{
      appearance:none; border:none; padding:.7rem 1rem; border-radius:12px; background:#f5f6f7; color:#111;
      cursor:pointer; font-weight:700; box-shadow: inset 0 -2px 0 rgba(0,0,0,.05); transition:.2s transform,.2s filter
    }
    button:hover{ transform: translateY(-2px) }
    .primary{ background: linear-gradient(180deg, #ffdbe6, #ffc5d7); color:#8b1b3f }
    .good{ background: linear-gradient(180deg, #dcffe6, #bff5d7); color:#0e6b4b }
    .chip{ font-size:.85rem }

    details{ border:1px dashed rgba(255,255,255,.25); border-radius:12px; padding:.7rem 1rem; color:#fff }
    details[open]{ background: rgba(255,255,255,.05) }

    .footer{ padding: 8px 18px 24px; text-align:center; color:var(--muted) }

    /* Hearts */
    .bg{ position: fixed; inset:0; pointer-events:none; z-index:4; overflow:hidden }
    .heart{ position:absolute; font-size:12px; opacity:0; animation: float 6s linear forwards }
    @keyframes float{ 0%{ transform: translateY(20px) scale(.6) rotate(0deg); opacity:0 } 12%{ opacity:.85 } 100%{ transform: translateY(-110vh) scale(1.3) rotate(18deg); opacity:0 } }
    .secret{ display:none; margin-top:10px; font-size:1.05rem }
    .toast{ position: fixed; left:50%; transform: translateX(-50%); bottom: 18px; background: rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.25); padding:.6rem 1rem; border-radius:999px; box-shadow: 0 10px 30px rgba(0,0,0,.4); z-index: 9; display:none; color:white }

    /* Brief */
    .letter{ line-height:1.75; font-size:1.02rem }
    .letter h4{ margin:.2rem 0 .6rem 0; font-size:1.1rem; color:#ffd6f3 }
    .letter p{ margin:.7rem 0 }
    .letter .sign{ margin-top:.8rem; color: var(--muted); font-style: italic }

    .sterrenquote{ font-style: italic; color:#ffd6f3; margin-top: .8rem; text-align:center; font-size:1.1rem; animation: fadein 2.5s ease }
    @keyframes fadein{ from{opacity:0} to{opacity:1} }

    /* --- NIEUW: Kleine extra's ‚Äì nette lijsten en players --- */
    .list-plain{ list-style:none; padding-left:0; margin:0 }
    .list-plain li{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:.6rem .8rem; border:1px solid rgba(255,255,255,.15);
      border-radius:10px; background:rgba(255,255,255,.05); margin:.45rem 0;
    }
    .list-plain .meta{ color:var(--muted); font-size:.92rem }
    .list-plain .row{ display:flex; flex-wrap:wrap; gap:8px; align-items:center }
    .players-wrap{
      display:grid; gap:10px; margin-top:.6rem;
      grid-template-columns: 1fr;
    }
    @media (min-width: 720px){
      .players-wrap{ grid-template-columns: 1fr 1fr }
    }
    /* Agenda badges */
    .badge{
      display:inline-block; padding:.2rem .55rem; border-radius:999px;
      background: rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.2); font-size:.82rem
    }
    .badge.good{ background: linear-gradient(180deg, #dcffe6, #bff5d7); color:#0e6b4b; border:none }
    .badge.soon{ background: linear-gradient(180deg, #fff7cc, #ffe89a); color:#6a5200; border:none }
    .badge.past{ background: rgba(255,255,255,.08); color:#b8c0cc }
  </style>
</head>
<body>
  <!-- INTRO -->
  <div class="intro show" id="intro">
    <div class="stars" id="stars_i"></div>
    <div class="stars2" id="stars2_i"></div>
    <div class="stars3" id="stars3_i"></div>
    <div class="box">
      <h1>Goedemorgen, <span id="introNaam">lieve Kiki</span> ‚ú®</h1>
      <p>Ik kan helaas niet naar je toe komen, maar wel iets naar je toe sturen..</p>
      <p class="mini">Wakker worden onder deze digitale sterren, die ikzelf op de juiste plek heb gezet</p>
      <button class="cta" id="startBtn">Klik NU, doe dan</button>
    </div>
  </div>

  <!-- STARS -->
  <div class="stars" id="stars"></div>
  <div class="stars2" id="stars2"></div>
  <div class="stars3" id="stars3"></div>

  <!-- Hearts layer -->
  <div class="bg" id="bg" aria-hidden="true"></div>

  <!-- APP -->
  <div class="wrap" id="app">
    <article class="card" id="card" role="main">
      <header>
        <div class="emoji">üíå</div>
        <div>
          <h1>
            Voor <span id="naam">Jou</span>
            <small class="muted">(ja jij daar met die mooie glimlach)</small>
          </h1>
        </div>
      </header>

      <main>
        <section class="panel" aria-live="polite">
          <p class="type" id="type"></p>
          <p class="sterrenquote">‚ú® Weet je wat het mooiste is? Dat onze sterren precies op de juiste plek staan. ‚ú®</p>

          <div class="btns">
            <button class="primary" id="openBtn">Ontvang kusjes üíã</button>
            <button class="good" id="secretBtn" title="pssst">Geheime boodschap üîê</button>
            <span class="chip" id="petname">Schatje üêª</span>
          </div>
          <p class="secret" id="secret">Ok√© luister... ik vind jou dus officieel <b>geweldig</b>. Zoals, "ik-sta-met-een-stom-hoofd-te-glimlachen-naar-m‚Äôn-telefoon" geweldig. ü•∞</p>
        </section>

        <!-- NIEUWE KLEINE EXTRA'S -->
        <aside class="panel" id="extras">
          <h3 style="margin-top:0">Kleine extra's</h3>

          <!-- ONZE PLAYLIST -->
          <details open>
            <summary>Onze playlist üéµ</summary>

            <div style="display:flex; align-items:center; gap:10px; margin:.6rem 0">
              <label class="muted" style="display:flex; align-items:center; gap:8px; cursor:pointer">
                <input id="plToggle" type="checkbox" />
                Toon spelers (Spotify)
              </label>
              <a id="plOpenAll" class="chip" href="#" title="Open alle nummers in nieuwe tab">Open alles</a>
            </div>

            <ul id="playlist" class="list-plain"></ul>

            <div id="players" class="players-wrap" hidden></div>
          </details>

          <!-- ONZE AGENDA -->
          <details>
            <summary>Onze agenda üìÖ</summary>

            <form id="agForm" onsubmit="return false" style="display:grid; gap:10px; margin:.6rem 0">
              <input id="agTitle" type="text" placeholder="Wat gaan we doen?" required
                    style="padding:.65rem .8rem; border-radius:10px; border:1px solid rgba(255,255,255,.25); background:rgba(255,255,255,.09); color:white">
              <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px">
                <input id="agDate" type="date" required
                      style="padding:.6rem .8rem; border-radius:10px; border:1px solid rgba(255,255,255,.25); background:rgba(255,255,255,.09); color:white">
                <input id="agTime" type="time"
                      style="padding:.6rem .8rem; border-radius:10px; border:1px solid rgba(255,255,255,.25); background:rgba(255,255,255,.09); color:white">
              </div>
              <input id="agPlace" type="text" placeholder="Waar? (optioneel)"
                    style="padding:.6rem .8rem; border-radius:10px; border:1px solid rgba(255,255,255,.25); background:rgba(255,255,255,.09); color:white">
              <div class="btns">
                <button class="primary" id="agAdd">Moment toevoegen</button>
                <button class="chip" id="agClear" type="button" title="Leeg de agenda">Alles wissen</button>
              </div>
              <small class="muted">Agenda wordt lokaal opgeslagen (alleen op dit apparaat).</small>
            </form>

            <ul id="agendaList" class="list-plain"></ul>
          </details>
        </aside>

        <!-- BRIEF -->
        <section class="panel letter" id="brief">
          <h3 style="margin-top:0">Mijn brief aan jou</h3>
          <h4>Aller allerliefste Kiki Dingewolfs,</h4>

          <p>Ik denk dat ik alles al gezegd heb, maar je hebt vannacht n√≥g net even wat extra door mijn hoofd gespookt. Waarna ik vervolgens nu ben begonnen aan dit berichtje. Dus bij deze nogmaals, omdat ik het belangrijk vind dat je weet wat je voor mij betekent.</p>

          <p>Ik vind het zo fijn om met je te zijn. Je brengt zo veel warmte en echt iets bijzonders.</p>

          <p>De situatie is nou eenmaal lastig, toch geniet ik van wat we samen hebben. We hebben misschien ‚Äòniets‚Äô, maar tegelijk voelt het als alles. We zijn geen ‚Äòwij‚Äô in woorden en in ons verstand, maar wel in gevoel.</p>

          <p>Ik baal enorm als ik je een onaangenaam gevoel geef, dat is nooit mijn bedoeling. Integendeel wil ik je juist betrekken in mijn leven en je laten voelen dat je belangrijk voor me bent. 
          Ik ben blij dat je er bent en deel uitmaakt van mijn dagen. Dat maakt me gelukkig. Ik weet ik wat voor situatie we zitten, maar ik weet ook dat er iets echts tussen ons is. Iets dat niet vanzelfsprekend is. Juist door deze verhouding denk ik dat dergelijke momenten zijn gebeurd.</p>

          <p>Je verdient het mooiste Kiek. Wat er ook mag gebeuren, ik gun je alles. Met of zonder mij. Onze oprechte momenten betekenen veel voor me, en dat wil ik koesteren.</p>

          <p class="sign">‚Äî van mij, voor jou üíó</p>
        </section>

      </main>

      <div class="footer">
        Gemaakt met üíó en sterrenstof ‚ú® ‚Äî <span class="muted">(C) <span id="year"></span> Jouw Naam</span>
      </div>
    </article>
  </div>

  <div class="toast" id="toast">Geheime mode geactiveerd üòé</div>

  <script>
    /* Personalisatie */
    const params = new URLSearchParams(location.search);
    const naamParam = params.get('naam');
    if (naamParam) {
      const n = decodeURIComponent(naamParam);
      document.getElementById('naam').textContent = n;
      document.getElementById('introNaam').textContent = n;
      document.title = `Voor ${n} üí´`;
    }

    /* Jaar */
    document.getElementById('year').textContent = new Date().getFullYear();

    /* Typewriter */
    const text = `Hoi <strong>${naamParam || 'mooie jij'}</strong> ü´∂\n\nIk heb geen bloemen gestuurd (die verwelken), geen chocolade (die verdwijnt), maar iets blijvends: een klein hoekje internet dat helemaal voor jou is.\n\nScroll, klik, speel ‚Äì en onthoud: ik kies elke dag voor jou.`;
    const typeEl = document.getElementById('type');
    let i = 0;
    (function typeWriter(){
      if (i < text.length) {
        const ch = text[i++];
        if (ch === '<') {
          const end = text.indexOf('>', i);
          typeEl.innerHTML += text.slice(i-1, end+1);
          i = end + 1;
        } else if (ch === '\n') {
          typeEl.innerHTML += '<br/>';
        } else {
          typeEl.innerHTML += ch;
        }
        setTimeout(typeWriter, 16);
      }
    })();

    /* Stars seeding */
    function seedStars(container, count, sizeMin=1, sizeMax=2.2){
      for(let i=0;i<count;i++){
        const s=document.createElement('span');
        const size = sizeMin + Math.random()*(sizeMax-sizeMin);
        s.style.width = s.style.height = `${size}px`;
        s.style.left = `${Math.random()*100}%`;
        s.style.top  = `${Math.random()*100}%`;
        s.style.animationDelay = `${Math.random() * 5}s`;
        container.appendChild(s);
      }
    }
    seedStars(document.getElementById('stars'),   140, 1, 2.2);
    seedStars(document.getElementById('stars2'),  90,  1.5, 2.8);
    seedStars(document.getElementById('stars3'),  60,  2, 3.4);

    seedStars(document.getElementById('stars_i'),  60, 1, 2);
    seedStars(document.getElementById('stars2_i'), 40, 1.2, 2.4);
    seedStars(document.getElementById('stars3_i'), 25, 1.6, 3);

    /* Shooting stars */
    function shootingStar(){
      const s = document.createElement('div');
      s.className='streak';
      s.style.left = `${-10 + Math.random()*20}vw`;
      s.style.top  = `${-10 + Math.random()*30}vh`;
      document.body.appendChild(s);
      setTimeout(()=> s.remove(), 1300);
    }
    setInterval(()=> { if (Math.random() < 0.6) shootingStar() }, 3500);

    /* Hearts */
    const bg = document.getElementById('bg');
    function dropHearts(count = 18) {
      for (let j = 0; j < count; j++) {
        const span = document.createElement('span');
        span.className = 'heart';
        span.textContent = ['‚ù§','üíï','üíñ','üíò','üíó'][Math.floor(Math.random()*5)];
        span.style.left = Math.random()*100 + 'vw';
        span.style.bottom = '-20px';
        span.style.fontSize = (10 + Math.random()*26) + 'px';
        span.style.animationDuration = (4 + Math.random()*4) + 's';
        bg.appendChild(span);
        setTimeout(() => span.remove(), 7000);
      }
    }
    // Ambient hearts starten na intro
    let ambientHearts;
    function startAmbientHearts(){ ambientHearts = setInterval(()=> dropHearts(2), 2600) }
    function stopAmbientHearts(){ clearInterval(ambientHearts) }

    /* Buttons */
    const secret = document.getElementById('secret');
    document.getElementById('secretBtn').addEventListener('click', () => {
      secret.style.display = secret.style.display === 'block' ? 'none' : 'block';
    });

    const pet = document.getElementById('petname');
    const pets = ['Schatje üêª','Lieve jij ‚ú®','Lieverd üå∑','Knappe jij ü¶ä','Mijn favoriet üí´'];
    pet.addEventListener('click', () => {
      pet.textContent = pets[Math.floor(Math.random()*pets.length)];
    });

    /* Toast */
    const toast = document.getElementById('toast');
    function showToast(msg){ toast.textContent = msg; toast.style.display='block'; setTimeout(()=> toast.style.display='none', 2200) }

    /* Konami */
    const K = ['ArrowUp','ArrowUp','ArrowDown','ArrowDown','ArrowLeft','ArrowRight','ArrowLeft','ArrowRight','b','a'];
    let buffer = [];
    window.addEventListener('keydown', (e) => {
      buffer.push(e.key);
      if (buffer.length > K.length) buffer.shift();
      if (K.every((k, i) => buffer[i]?.toLowerCase() === k.toLowerCase())) {
        buffer = [];
        showToast('Geheime mode geactiveerd üòé');
        dropHearts(60);
        const extra = document.createElement('p');
        extra.className = 'secret';
        extra.style.display = 'block';
        extra.innerHTML = 'Bonus: als je dit leest, ben je officieel mijn <b>favoriete mens</b>. üéâ';
        typeEl.after(extra);
      }
    });

    /* Ontvang kusjes */
    function kissRain(){
      for (let i=0;i<42;i++){
        const s = document.createElement('span');
        s.textContent = Math.random()>0.5 ? 'üíã' : 'üòò';
        s.style.position='fixed';
        s.style.left = Math.random()*100 + 'vw';
        s.style.top = '-10px';
        s.style.fontSize = (18 + Math.random()*22) + 'px';
        s.style.transition = 'transform 3s linear, opacity 3s';
        s.style.zIndex = 6;
        document.body.append(s);
        requestAnimationFrame(() => {
          s.style.transform = `translateY(${110+Math.random()*20}vh)`;
          s.style.opacity = '0';
        });
        setTimeout(() => s.remove(), 3200);
      }
    }
    document.getElementById('openBtn').addEventListener('click', () => {
      kissRain();
      dropHearts(20);
      showToast('Kusjesregen! üòò');
    });

    /* --- NIEUW: ONZE PLAYLIST & AGENDA --- */

    // 1) Playlist ‚Äì jullie 4 nummers
    const PLAYLIST = [
      { title: 'Stop De Tijd', url: 'https://open.spotify.com/track/0Q6PoJX8JWndVLcJnM1BLX?si=3adcc4b701754614' },
      { title: 'Zij Laat Me Praten', url: 'https://open.spotify.com/track/25cvMotloW6bJCSP0hKG59?si=ebe3d3a77cd54a71' },
      { title: 'Zoveel Liefde', url: 'https://open.spotify.com/track/4osLdgj5ToLMc8EovfWFjx?si=66cf2acd2eee4ddd' },
      { title: 'Platonisch', url: 'https://open.spotify.com/track/6Mwcn4IEsarl0gDqJ29XFy?si=297a34c749e04973' },
    ];

    (function setupPlaylist(){
      const list = document.getElementById('playlist');
      const players = document.getElementById('players');
      const toggle = document.getElementById('plToggle');
      const openAll = document.getElementById('plOpenAll');

      // lijst renderen
      list.innerHTML = PLAYLIST.map((t,i)=>`
        <li>
          <div class="row">
            <strong>${t.title}</strong>
            <span class="meta">Spotify</span>
          </div>
          <div class="row">
            <a class="chip" href="${t.url}" target="_blank" rel="noopener">Open</a>
            <button class="chip" data-play="${i}">‚ñ∂Ô∏é Spelen</button>
          </div>
        </li>
      `).join('');

      // players renderen
      function makeEmbed(u){
        const m = u.match(/\/track\/([^?]+)/);
        const id = m ? m[1] : null;
        if (!id) return '';
        return `
          <iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/${id}?utm_source=generator"
            width="100%" height="152" frameborder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
        `;
      }
      players.innerHTML = PLAYLIST.map(t=> makeEmbed(t.url)).join('');

      // open alles
      openAll.addEventListener('click', (e)=>{
        e.preventDefault();
        PLAYLIST.forEach(t=> window.open(t.url, '_blank', 'noopener'));
        showToast('Playlist geopend üéß');
      });

      // ‚Äúspelen‚Äù klikt naar de juiste embed (als zichtbaar), anders opent link
      list.addEventListener('click', (e)=>{
        const btn = e.target.closest('button[data-play]');
        if (!btn) return;
        const idx = Number(btn.dataset.play);
        if (!toggle.checked){
          window.open(PLAYLIST[idx].url, '_blank', 'noopener');
          return;
        }
        const ifr = players.querySelectorAll('iframe')[idx];
        if (ifr){
          ifr.scrollIntoView({behavior:'smooth', block:'center'});
          ifr.style.filter = 'brightness(1.2)';
          setTimeout(()=> ifr.style.filter='', 700);
        }
      });

      // toggle players
      toggle.addEventListener('change', ()=>{
        players.hidden = !toggle.checked;
      });
    })();

    // 2) Onze agenda ‚Äì simpele planner (lokaal)
    (function setupAgenda(){
      const form = document.getElementById('agForm');
      const title = document.getElementById('agTitle');
      const date = document.getElementById('agDate');
      const time = document.getElementById('agTime');
      const place = document.getElementById('agPlace');
      const add = document.getElementById('agAdd');
      const clear = document.getElementById('agClear');
      const list = document.getElementById('agendaList');

      const KEY = 'kiki_agenda_v1';

      let items = load();

      function sortItems(a,b){ return +new Date(a.when) - +new Date(b.when) }

      function load(){ try{ return JSON.parse(localStorage.getItem(KEY)) ?? [] }catch{ return [] } }
      function save(){ try{ localStorage.setItem(KEY, JSON.stringify(items)) }catch{} }

      function fmtDate(d){
        const dt = new Date(d);
        return dt.toLocaleString('nl-NL', { weekday:'long', day:'numeric', month:'long', year:'numeric', hour:'2-digit', minute:'2-digit' });
      }
      function relTime(d){
        const now = new Date();
        const dt = new Date(d);
        const ms = +dt - +now;
        const abs = Math.abs(ms);
        const mins = Math.round(abs/60000);
        if (ms < 0) return { text:`${mins<60 ? `${mins} min` : `${Math.round(mins/60)} uur`} geleden`, cls:'past' };
        if (mins < 60) return { text:`over ${mins} min`, cls:'soon' };
        const days = Math.round(mins/1440);
        if (days <= 7) return { text:`over ${days} dag${days!==1?'en':''}`, cls:'soon' };
        return { text:`over ~${Math.round(days/7)} week${Math.round(days/7)!==1?'en':''}`, cls:'' };
      }

      function render(){
        if (!items.length){
          list.innerHTML = `<li class="muted" style="justify-content:center">Nog geen plannen‚Ä¶ voeg er eentje toe ‚ú®</li>`;
          return;
        }
        items.sort(sortItems);
        list.innerHTML = items.map((it,i)=>{
          const r = relTime(it.when);
          return `
            <li>
              <div>
                <div><strong>${it.title}</strong> ${it.place ? `<span class="meta">¬∑ ${it.place}</span>` : ''}</div>
                <div class="meta">${fmtDate(it.when)}</div>
              </div>
              <div class="row">
                <span class="badge ${r.cls}">${r.text}</span>
                <button class="chip" data-del="${i}">√ó</button>
              </div>
            </li>
          `;
        }).join('');
      }
      render();

      add.addEventListener('click', ()=>{
        if (!title.value.trim() || !date.value) return;
        const when = new Date(`${date.value}T${time.value || '12:00'}`);
        items.push({ title: title.value.trim(), place: place.value.trim(), when });
        save();
        render();
        title.value=''; place.value='';
        showToast('Moment toegevoegd üí´');
      });

      clear.addEventListener('click', ()=>{
        items = [];
        save();
        render();
        showToast('Agenda geleegd üßπ');
      });

      list.addEventListener('click', (e)=>{
        const i = e.target?.dataset?.del;
        if (i===undefined) return;
        items.splice(Number(i),1);
        save(); render();
      });

      // update badges elke minuut
      setInterval(()=> render(), 60000);
    })();

    /* --- Extra sneltoetsen --- */
    window.addEventListener('keydown', (e)=>{
      if (e.key.toLowerCase() === 's'){ kissRain(); showToast('Kusjesregen! üòò') }
      if (e.key.toLowerCase() === 'l'){ document.getElementById('brief')?.scrollIntoView({behavior:'smooth'}) }
    });

    /* Intro -> App overgang */
    const intro = document.getElementById('intro');
    const appCard = document.getElementById('card');

    function burst(x,y){
      const N = 18;
      for(let i=0;i<N;i++){
        const b = document.createElement('div');
        b.className='burst-star';
        const a = (Math.PI*2) * (i/N) + Math.random()*0.7;
        const d = 30 + Math.random()*70;
        b.style.left = (x) + 'px';
        b.style.top  = (y) + 'px';
        b.style.setProperty('--tx', `${Math.cos(a)*d}px`);
        b.style.setProperty('--ty', `${Math.sin(a)*d}px`);
        document.body.appendChild(b);
        setTimeout(()=> b.remove(), 720);
      }
    }

    document.getElementById('startBtn').addEventListener('click', (e) => {
      const rect = intro.getBoundingClientRect();
      const x = e.clientX || (rect.left + rect.width/2);
      const y = e.clientY || (rect.top + rect.height/2);
      intro.style.setProperty('--cx', x + 'px');
      intro.style.setProperty('--cy', y + 'px');
      burst(x,y);
      shootingStar();
      intro.classList.add('explode');

      setTimeout(()=> {
        appCard.classList.add('app-enter');
        showToast('De sterren staan goed ‚ú®');
        setTimeout(()=> startAmbientHearts(), 600);
      }, 300);

      setTimeout(()=> { intro.style.display='none'; }, 950);
    });

    if (location.hash === '#brief') {
      setTimeout(() => document.getElementById('brief')?.scrollIntoView({behavior:'smooth'}), 800);
    }
  </script>
</body>
</html>
